<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>玩法</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318"/>

    <style>

        .currSerachBtn{
            box-shadow: 0 15px 18px -6px rgb(45 140 240 / 65%) !important;
        }

        .currReloadBtn{
            box-shadow: 0 15px 18px -6px rgb(146 109 222 / 65%) !important;
        }

        .layui-table-cell{
            height:46px;
            line-height: 46px;
        }

        /*td .layui-form-select {*/
        /*    !*margin-top: -10px;*!*/
        /*    !*margin-left: -15px;*!*/
        /*    !*margin-right: -15px;*!*/
        /*    vertical-align: middle;*/
        /*    !*text-align: center;*!*/
        /*}*/

        /*.layui-table-cell {*/
        /*    overflow: visible !important;*/
        /*}*/

        /*.layui-table-view .layui-table th{*/
        /*    overflow:hidden;*/
        /*}*/

        /*.layui-table-view .layui-table th{*/
        /*    overflow:hidden;*/
        /*}*/

        /*.layui-table-view .layui-table[lay-size="sm"] .layui-select-title .layui-input {*/
        /*    height: 28px;*/
        /*    margin-top: -8px;*/
        /*}*/
        /*.layui-table-view .layui-table[lay-size="sm"] .layui-form-select dl dt,.layui-table-view .layui-form-select dl dd {*/
        /*    line-height: 28px;*/
        /*}*/
        /*.layui-table-view .layui-table[lay-size="sm"] .layui-form-select dl {*/
        /*    top: 28px;*/
        /*}*/
        /*.layui-table-view .layui-table .layui-select-title .layui-input {*/
        /*    height: 32px;*/
        /*    margin-top: -3px;*/
        /*}*/
        /*.layui-table-view .layui-table .layui-form-select dl dt,.layui-table-view .layui-form-select dl dd {*/
        /*    line-height: 32px;*/
        /*}*/
        /*.layui-table-view .layui-table .layui-form-select dl {*/
        /*    top: 32px;*/
        /*}*/
        /*.layui-table-view .layui-table[lay-size="lg"] .layui-select-title .layui-input {*/
        /*    height: 38px;*/
        /*    margin-top: 0;*/
        /*}*/
        /*.layui-table-view .layui-table[lay-size="lg"] .layui-form-select dl dt,.layui-table-view .layui-form-select dl dd {*/
        /*    line-height: 38px;*/
        /*}*/
        /*.layui-table-view .layui-table[lay-size="lg"] .layui-form-select dl {*/
        /*    top: 38px;*/
        /*}*/

    </style>

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">

            <!--            <div class="layui-form-item layui-form-pane">-->

            <!--                <div class="layui-inline" style="margin-top:10px;">-->
            <!--                    &lt;!&ndash;                <div class="layui-btn " data-type="reload"><i class="layui-icon"></i>查询</div>&ndash;&gt;-->
            <!--                    <div id="reloadtable" class="layui-btn layui-bg-cyan"><i class="layui-icon"></i>刷新数据</div>-->
            <!--                </div>-->
            <!--            </div>-->

            <!-- 表格工具栏 -->
            <form class="layui-form toolbar">
                <div class="layui-form-item" >


                    <!--                    <div class="layui-inline">-->
                    <!--                        <label class="layui-form-label">授权b地址:</label>-->
                    <!--                        <div class="layui-input-inline">-->
                    <!--                            <input name="b_address" id="b_address" class="layui-input" placeholder="请输入授权b地址"/>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                    <div class="layui-inline">-->
                    <!--                        <label class="layui-form-label">编号ID:</label>-->
                    <!--                        <div class="layui-input-inline">-->
                    <!--                            <input name="id_nums" id="id_nums" class="layui-input" placeholder="请输入ID"/>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                    <div class="layui-inline">-->
                    <!--                        <label class="layui-form-label">授权状态:</label>-->
                    <!--                        <div class="layui-input-inline">-->
                    <!--                            <select name="authorization" id="authorization" lay-filter="authorization">-->
                    <!--                                <option value="888888">全部</option>-->
                    <!--                                <option value="1">未授权</option>-->
                    <!--                                <option value="2">已授权</option>-->
                    <!--                            </select>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                    <div class="layui-inline">-->
                    <!--                        <label class="layui-form-label">被杀状态</label>-->
                    <!--                        <div class="layui-input-inline">-->
                    <!--                            <select name="AlreadyKilled" id="AlreadyKilled" lay-filter="AlreadyKilled">-->
                    <!--                                <option value="888888">全部</option>-->
                    <!--                                <option value="1">已杀</option>-->
                    <!--                                <option value="2">未杀</option>-->
                    <!--                            </select>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <div class="layui-inline">&emsp;
                        <button class="layui-btn icon-btn currSerachBtn" lay-filter="userTbSearch" lay-submit >
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                        <button class="layui-btn icon-btn currReloadBtn" id="reloadData" style="background-color: #926dde;border-color: #926dde;">
                            <i class="layui-icon layui-icon-refresh"></i>刷新数据
                        </button>

                        <button class="layui-btn icon-btn currReloadBtn"
                                id="addPlayInfo"
                                style="background-color: #fb7299;border-color: #fb7299;">
                            <i class="layui-icon layui-icon-add-1"></i>添加玩法
                        </button>
                    </div>
                </div>
            </form>
            <!-- 数据表格 -->
            <table id="userTable" lay-filter="userTable" style="margin-top:10px"></table>
        </div>
    </div>
</div>


<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=318"></script>

<script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../../assets/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../assets/js/config.url.js"></script>

<!--<script type="text/html" id="editKinds" >-->
<!--    <select name="selectKinds" lay-filter="selectKinds" id="selectKinds"  data-value = {{d.Kinds.toString()}} >-->
<!--        <option value="1">对手</option>-->
<!--        <option value="2">自己</option>-->
<!--    </select>-->
<!--</script>-->

<script type="text/html" id="editState" >
    <select name="editName" lay-filter="editName" id="editName"  data-value = {{d.Name}} >
        <option value="牛牛">牛牛</option>
        <option value="尾数">尾数</option>
        <option value="单双">单双</option>
    </select>
</script>
<!--数据表格操作工具栏-->
<script type="text/html" id="orderListBar">
    <a class="layui-btn layui-btn-sm layui-btn-radius" style="background: #1bdad4" lay-event="updateDay"><i class="layui-icon layui-icon-refresh-1"></i>更新每日数据</a>
    <a class="layui-btn layui-btn-sm layui-btn-radius" style="background: #da1b8e" lay-event="updateAssignDayData"><i class="layui-icon layui-icon-refresh-1"></i>更新日数据</a>


    <!--    {{#  if(d.LeadingPopUpWindowSwitch == 1){ }}-->
    <!--    <a class="layui-btn layui-btn-sm layui-btn-radius" style="background: #1bdad4" lay-event="popContent"><i class="layui-icon layui-icon-set"></i>弹窗内容</a>-->
    <!--    {{#  } }}-->
    <!--    {{#  if(d.Authorization == 1){ }}-->
    <!--    <a class="layui-btn layui-btn-sm layui-btn-radius" style="background: #da991b" lay-event="queryStatus"><i class="layui-icon">&#xe666;</i>查询状态</a>-->
    <!--    <a class="layui-btn layui-btn-sm layui-btn-radius " lay-event="changebtn"><i class="layui-icon">&#xe659;</i>更新余额</a>-->
    <!--    <a class="layui-btn layui-btn-danger layui-btn-sm layui-btn-radius" lay-event="withdraw"><i class="layui-icon">&#xe698;</i>抽取</a>-->
    <!--    {{#  } else if(d.Authorization == 2){ }}-->
    <!--    <a class="layui-btn layui-btn-sm layui-btn-radius " lay-event="changebtn"><i class="layui-icon">&#xe659;</i>更新余额</a>-->
    <!--    <a class="layui-btn layui-btn-danger layui-btn-sm layui-btn-radius" lay-event="withdraw"><i class="layui-icon">&#xe698;</i>抽取</a>-->
    <!--    {{#  } }}-->
</script>



<script>

    // var mybck= $.cookie('tokenMyb');
    // //alert(document.cookie);
    // //console.log(mybck)
    // if(mybck == "" || mybck == null){
    //
    //     window.top.location.href="../../login.html";
    //
    // }else{
    //
    //
    // }

    var jsondata ;
    let jsonDataInit;

    //表中如果需要select 方式,最好引入optimizeSelectOption
    var fn1 = function (field) {
        return function (data) {
            var value = data[field];
            return [
                '<select name="selectKinds" lay-filter="selectKinds" id="selectKinds" lay-search="true" value="' + value + '">',
                '<option value="1"' + (value === 1 ? 'selected' : '') + '>对手</option>',
                '<option value="2"' + (value === 2 ? 'selected' : '') + '>自己</option>',
                '</select>'
            ].join('');
        };
    };

    var f2 = function (field) {
        return function (data) {
            let value = data[field];
            return [
                '<select name="editName" lay-filter="editName" id="editName" lay-search="true" value="' + value + '">',
                '<option value="牛牛"' + (value === "牛牛" ? 'selected' : '') + '>牛牛</option>',
                '<option value="尾数"' + (value === '尾数' ? 'selected' : '') + '>尾数</option>',
                '<option value="单双"' + (value === '单双' ? 'selected' : '') + '>单双</option>',
                '</select>'
            ].join('');
        };
    };

    layui.use(['layer', 'form', 'table', 'util', 'admin', 'xmSelect','notice','optimizeSelectOption'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;
        var table = layui.table;
        var util = layui.util;
        var admin = layui.admin;
        var xmSelect = layui.xmSelect;
        var notice = layui.notice;



        var log_login_request_param = {};
        // log_login_request_param['token']= mybck;
        log_login_request_param['action']='GET';


        /* 渲染表格 */
        var insTb = table.render({
            elem: '#userTable',
            url: js_global_requestAddress_GetUsers+"?action=GET",
            method: 'GET',
            // where:log_login_request_param,
            // toolbar:true,
            // defaultToolbar: ['filter'],
            // toolbar: ['<p>',
            //     '<button lay-event="add" class="layui-btn layui-btn-sm icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>&nbsp;',
            //     '<button lay-event="del" class="layui-btn layui-btn-sm layui-btn-danger icon-btn"><i class="layui-icon">&#xe640;</i>删除</button>',
            //     '</p>'].join(''),
            cellMinWidth: 100,
            page :  { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                //,curr: 5 //设定初始在第 5 页
                ,groups: 10 //只显示 1 个连续页码
                ,first: "首页" //不显示首页
                ,last: "尾页"//不显示尾页
            },
            height : "full-100",
            limit : 30,
            limits : [30,50,100],
            response: {
                statusName: 'code' //规定数据状态的字段名称，默认：code
                ,statusCode: 1 //规定成功的状态码，默认：0
                ,dataName: 'result' //规定数据列表的字段名称，默认：data
            },
            // ,hide:true
            // id : "systemLog",
            cols: [[
                {type: 'checkbox'},
                {field: 'ID',title:'ID',sort: true,align:"center"},
                // {field: 'Name', title: '下注概率',width:170, sort: true,align:"center",templet:"#editState"},
                {field: 'Trc20Address', title: '玩家地址',width:300, sort: true,align:"center"},
                // {field: 'Name', title: '玩法', sort: true,align:"center",edit: 'text'},
                {field: 'InvitationCode', title: '邀请码',width:125, sort: true,align:"center",edit: 'text'},
                {field: 'SuperiorId', title: '上级id',width:370,  sort: true,align:"center",edit: 'text'},
                {field: 'NextSuperiorId', title: '次上级id', sort: true,edit: 'text',align:"center"},
                {field: 'NextNextSuperiorId', title: '次次上级id',sort: true,align:"center"},
                // {field: 'Kinds', title: '类型', sort: true,edit: 'text',align:"center",templet:function(d){
                //      if(d.Kinds == "1"){//对手
                //         return '<button class="layui-btn  layui-btn-sm" style="background-color: #33cabb;border-color: #33cabb;">'+'对手'+'</button>'
                //     }else if(d.Kinds == "2"){//自己
                //         return '<button class="layui-btn  layui-btn-sm" style="background-color: #faa64b;border-color: #faa64b;">'+'自己'+'</button>'
                //     }
                // }},

                {
                    field: 'Created', title: '创建时间',align:"center",width:160, templet: function (d) {
                        return util.toDateString(d.Created* 1000);
                    }, sort: true
                },

                // {
                //     field: 'updated_at', title: '更新时间',align:"center", templet: function (d) {
                //         return util.toDateString(d.updated_at* 1000);
                //     }, sort: true
                // },
                // {title: '操作', width:300, templet:'#orderListBar',fixed:"right",align:"center"}
            ]],
            done: function (res, curr, count) {

                jsonDataInit = res.result

                $('tr').css({'background-color': '#fff', 'color': '#191a1c'});

                res.result.forEach( (item, index) => {//根据已有的值回填下拉框

                    // layui.each($("select[name='editName']", ""),  (index, item) => {
                    //     var elem = $(item);
                    //     let currNum = elem.data('value')
                    //     // currNum = (currNum * 10) + "%"
                    //     // console.log("elem.data('value')",elem.data('value'))
                    //     elem.next().children().children()[0].defaultValue = currNum;
                    //     // elem.val(elem.data('value')).parents('div.layui-table-cell').css('overflow', 'visible');
                    //     //elem.val(elem.data('value'));
                    // });

                    // layui.each($("select[name='selectKinds']", ""),  (index, item) => {
                    //     var elem = $(item);
                    //     let currNum = elem.data('value').toString()
                    //     // console.log("currNum",currNum)
                    //     // console.log("elem.data('value')",elem.data('value'))
                    //     // elem.next().children().children()[0].defaultValue = currNum;
                    //     // elem.val(elem.data('value')).parents('div.layui-table-cell').css('overflow', 'visible');
                    //     elem.val(currNum);
                    // });

                    table.render('select');
                })
            }
        });

        //添加公告点击事件弹窗
        form.on('submit(userTbSearch)', function (data) {

            var index = layui.layer.open({
                area: ['600px', '500px'],
                fixed: false, //不固定
                maxmin: false,
                title : "添加公告",
                skin: 'layui-layer-rim',//加上边框
                type : 2,
                content : "rebotlist_add.html",
                success : function(layero, index){
                    var body = layui.layer.getChildFrame('body', index);



                },
                end : function() {//弹窗关闭后的回调函数
                    //利用laypage实现局部刷新,以下两种方式都可以
                    // $(".layui-laypage-btn").click()
                    //直接刷新当前修改的行
                    // $(".layui-laypage-btn")[0].click()

                    // window.parent.location.reload();


                    // window.location.reload();
                }
            })

            return false;
        });

        /* 表格搜索 */
        var currTempObj;
        var bet_tb_this;
        form.on('submit(userTbSearch)', function (data) {

            // console.log("currTempObj",data.field.username)
            // insTb.reload({where: data.field, page: {curr: 1}});
            currTempObj = {}
            currTempObj.token = $.cookie('tokenMyb');
            currTempObj.status = 1;
            currTempObj.action = "GET";


            if(data.field.remark === ""){


            }else{
                currTempObj.remark = data.field.remark
            }


            if(data.field.fox_address === ""){


            }else{
                currTempObj.fox_address = data.field.fox_address
            }


            if(data.field.b_address === ""){


            }else{
                currTempObj.b_address = data.field.b_address
            }


            if(data.field.id_nums === ""){


            }else{
                currTempObj.id = data.field.id_nums.split('11784374')[1]
            }

            if(data.field.authorization === "888888"){


            }else{
                currTempObj.authorization = data.field.authorization
            }



            if(data.field.AlreadyKilled === "888888"){


            }else{
                currTempObj.already_killed = data.field.AlreadyKilled
            }


            //2.6.0之前清除保留之前的数据的最有用的方式
            if (bet_tb_this != null) {
                // console.log("book_tb_this--不为null",bet_tb_this)
                bet_tb_this.where = {};  //置空where
            }
            insTb.reload({
                where: currTempObj,
                page: {curr: 1},
                done:function(){
                    bet_tb_this = this;
                    // console.log("book_tb_this----重载后的值",bet_tb_this)
                }
            },false);


            return false;
        });


        /* 表格工具条点击事件 */
        table.on('tool(userTable)', function (obj) {
            var currDatas  = obj.data;
            if (obj.event === 'changebtn') { // 修改

                var param_first={};
                param_first['token']=mybck;
                param_first['id']=currDatas.ID;
                param_first['fox_address']=currDatas.FoxAddress;

                $.ajax({
                    url: js_global_requestAddress_updateOneFishUsd,
                    data: param_first,
                    type: "POST",
                    dataType: "json",
                    success: function (addResult) {

                        if (addResult.code === 200) {
                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 1});

                            $.ajax({
                                url: js_global_requestAddress_updateOneFishEth,
                                data: param_first,
                                type: "POST",
                                dataType: "json",
                                success: function (addResult) {

                                    if (addResult.code === 200) {
                                        // layer.msg(addResult.msg);
                                        notice.msg(addResult.msg, {icon: 1});

                                        insTb.reload();
                                    } else {

                                        // layer.msg(addResult.msg);
                                        notice.msg(addResult.msg, {icon: 2});


                                    }


                                },
                                end : function() {//弹窗关闭后的回调函数
                                    //利用laypage实现局部刷新,以下两种方式都可以
                                    // $(".layui-laypage-btn").click()
                                    //直接刷新当前修改的行
                                    // $(".layui-laypage-btn")[0].click()
                                    // window.parent.location.reload();
                                }

                            });

                        } else {

                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 2});


                        }


                    },
                    end : function() {//弹窗关闭后的回调函数
                        //利用laypage实现局部刷新,以下两种方式都可以
                        // $(".layui-laypage-btn").click()
                        //直接刷新当前修改的行
                        // $(".layui-laypage-btn")[0].click()
                        // window.parent.location.reload();
                    }

                });



            } else if (obj.event === 'withdraw') { // 提现

                if(currDatas.Authorization == "1"){

                    notice.msg('鱼还未授权,请点击查询状态按钮,更新鱼是否授权的状态!', {icon: 2});

                }else if(currDatas.Authorization == "2"){
                    // console.log("withdraw",currDatas)
                    jsondata = JSON.stringify(currDatas)
                    var index = layui.layer.open({
                        area: ['900px', '300px'],
                        fixed: false, //不固定
                        maxmin: false,
                        title : "提现",
                        skin: 'layui-layer-rim',//加上边框
                        type : 2,
                        content : "fish_withdraw.html",
                        success : function(layero, index){
                            var body = layui.layer.getChildFrame('body', index);
                            // if(currDatas) {
                            //
                            //     body.find("#head_images").val(currDatas.head_images);
                            //     body.find("#username").val(currDatas.username);
                            //     body.find("#min_money").val(currDatas.min_money);
                            //     body.find("#max_money").val(currDatas.max_money);
                            //     body.find("#money").val(currDatas.money);
                            //
                            // }

                        },
                        end : function() {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            // $(".layui-laypage-btn")[0].click()
                            // window.location.reload();
                        }

                    })
                    window.sessionStorage.setItem("index",index);
                    //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                    $(window).on("resize",function(){
                        layui.layer.full(window.sessionStorage.getItem("index"));
                    })
                }



            } else if (obj.event === 'withdrawAll') { // 提现全部
                layer.confirm('系统将对该鱼进行提现全部，确认要提现全部吗？', {
                    icon:1,
                    title:'温馨提示',
                    skin: 'layui-layer-admin',
                    shade: .1
                }, function (i) {
                    layer.close(i);
                    // var loadIndex = layer.load(2);

                    var param = {};
                    param['token'] = $.cookie('tokenMyb');
                    param['id'] = currDatas.ID;
                    param['fox_address']=currDatas.FoxAddress;
                    param['b_address'] = currDatas.BAddress


                    $.ajax({
                        url: js_global_requestAddress_tiXian,
                        data: param,
                        type: "POST",
                        dataType: "json",
                        success: function (addResult) {

                            if (addResult.code === 200) {
                                // layer.msg(addResult.msg);
                                notice.msg(addResult.msg, {icon: 1});
                                insTb.reload();
                                layer.close(index);


                            } else {

                                // layer.msg(addResult.msg);
                                notice.msg(addResult.msg, {icon: 2});


                            }


                        },
                        end : function() {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            // $(".layui-laypage-btn")[0].click()
                            // window.parent.location.reload();
                        }

                    });

                });
            }else if (obj.event === 'queryStatus') { // 主动查询状态
                jsondata = JSON.stringify(currDatas)
                var index = layui.layer.open({
                    area: ['800px', '200px'],
                    fixed: false, //不固定
                    maxmin: false,
                    title : "查询授权状态",
                    skin: 'layui-layer-rim',//加上边框
                    type : 2,
                    content : "query_auth_status.html",
                    success : function(layero, index){
                        var body = layui.layer.getChildFrame('body', index);
                        // if(currDatas) {
                        //
                        //     body.find("#head_images").val(currDatas.head_images);
                        //     body.find("#username").val(currDatas.username);
                        //     body.find("#min_money").val(currDatas.min_money);
                        //     body.find("#max_money").val(currDatas.max_money);
                        //     body.find("#money").val(currDatas.money);
                        //
                        // }

                    },
                    end : function() {//弹窗关闭后的回调函数
                        //利用laypage实现局部刷新,以下两种方式都可以
                        // $(".layui-laypage-btn").click()
                        //直接刷新当前修改的行
                        // $(".layui-laypage-btn")[0].click()
                        // window.location.reload();
                    }

                })
                window.sessionStorage.setItem("index",index);
                //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                $(window).on("resize",function(){
                    layui.layer.full(window.sessionStorage.getItem("index"));
                })
            }else if (obj.event === 'popContent') { // 给每个鱼设置弹窗内容
                jsondata = JSON.stringify(currDatas)
                var index = layui.layer.open({
                    area: ['800px', '350px'],
                    fixed: false, //不固定
                    maxmin: false,
                    title : "设置弹窗内容",
                    skin: 'layui-layer-rim',//加上边框
                    type : 2,
                    content : "add_pop_content.html",
                    success : function(layero, index){
                        var body = layui.layer.getChildFrame('body', index);
                        // if(currDatas) {
                        //
                        //     body.find("#head_images").val(currDatas.head_images);
                        //     body.find("#username").val(currDatas.username);
                        //     body.find("#min_money").val(currDatas.min_money);
                        //     body.find("#max_money").val(currDatas.max_money);
                        //     body.find("#money").val(currDatas.money);
                        //
                        // }

                    },
                    end : function() {//弹窗关闭后的回调函数
                        //利用laypage实现局部刷新,以下两种方式都可以
                        // $(".layui-laypage-btn").click()
                        //直接刷新当前修改的行
                        // $(".layui-laypage-btn")[0].click()
                        // window.location.reload();
                    }

                })
                window.sessionStorage.setItem("index",index);
                //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                $(window).on("resize",function(){
                    layui.layer.full(window.sessionStorage.getItem("index"));
                })
            }else if(obj.event === 'updateDay'){ //更新每日数据

                layer.confirm('系统将更新每日数据，确认要更新吗？', {
                    icon:2,
                    title:'温馨提示',
                    skin: 'layui-layer-admin',
                    shade: .1
                }, function (i) {
                    layer.close(i);
                    // var loadIndex = layer.load(2);
                    $.ajax({
                        url: js_global_requestAddress_SetEverydayStatistics+"?ID="+currDatas.ID,
                        type: "GET",
                        dataType: "json",
                        success: function (addResult) {

                            if (addResult.code === 200) {
                                // layer.msg(addResult.msg);
                                notice.msg(addResult.msg, {icon: 1});
                                insTb.reload();
                            } else {

                                // layer.msg(addResult.msg);
                                notice.msg(addResult.msg, {icon: 2});
                                insTb.reload();
                            }
                        },
                        end : function() {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            // $(".layui-laypage-btn")[0].click()
                            // window.parent.location.reload();
                        }

                    });

                });
            }else if(obj.event === 'updateAssignDayData') { //更新指定日数据

                jsondata = JSON.stringify(currDatas)
                var index = layui.layer.open({
                    area: ['800px', '250px'],
                    fixed: false, //不固定
                    maxmin: false,
                    title : "更新指定日数据",
                    skin: 'layui-layer-rim',//加上边框
                    type : 2,
                    content : "add_assign_day.html",
                    success : function(layero, index){
                        var body = layui.layer.getChildFrame('body', index);
                        // if(currDatas) {
                        //     body.find("#head_images").val(currDatas.head_images);
                        //     body.find("#username").val(currDatas.username);
                        //     body.find("#min_money").val(currDatas.min_money);
                        //     body.find("#max_money").val(currDatas.max_money);
                        //     body.find("#money").val(currDatas.money);
                        // }
                    },
                    end : function() {//弹窗关闭后的回调函数
                        //利用laypage实现局部刷新,以下两种方式都可以
                        // $(".layui-laypage-btn").click()
                        //直接刷新当前修改的行
                        // $(".layui-laypage-btn")[0].click()
                        // window.location.reload();
                    }

                })
                window.sessionStorage.setItem("index",index);
                //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                $(window).on("resize",function(){
                    layui.layer.full(window.sessionStorage.getItem("index"));
                })

            }
        });

        /* 表格头工具栏点击事件 */
        table.on('toolbar(userTable)', function (obj) {
            if (obj.event === 'add') { // 添加
                showEditModel();
            } else if (obj.event === 'del') { // 删除
                var checkRows = table.checkStatus('userTable');
                if (checkRows.data.length === 0) {
                    layer.msg('请选择要删除的数据', {icon: 2});
                    return;
                }
                var ids = checkRows.data.map(function (d) {
                    return d.userId;
                });
                doDel({ids: ids});
            }
        });

        /* 显示表单弹窗 */
        function showEditModel(mData) {
            admin.open({
                type: 1,
                title: (mData ? '修改' : '添加') + '用户',
                content: $('#userEditDialog').html(),
                success: function (layero, dIndex) {
                    // 回显表单数据
                    form.val('userEditForm', mData);
                    // 表单提交事件
                    form.on('submit(userEditSubmit)', function (data) {
                        data.field.roleIds = insRoleSel.getValue('valueStr');
                        var loadIndex = layer.load(2);
                        $.get(mData ? '../../json/ok.json' : '../../json/ok.json', data.field, function (res) {  // 实际项目这里url可以是mData?'user/update':'user/add'
                            layer.close(loadIndex);
                            if (res.code === 200) {
                                layer.close(dIndex);
                                layer.msg(res.msg, {icon: 1});
                                insTb.reload({page: {curr: 1}});
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        }, 'json');
                        return false;
                    });
                    // 渲染多选下拉框
                    var insRoleSel = xmSelect.render({
                        el: '#userEditRoleSel',
                        name: 'userEditRoleSel',
                        layVerify: 'required',
                        layVerType: 'tips',
                        data: [{
                            name: '管理员',
                            value: 1
                        }, {
                            name: '普通用户',
                            value: 2
                        }, {
                            name: '游客',
                            value: 3
                        }]
                    });
                    // 回显选中角色
                    if (mData && mData.roles) {
                        insRoleSel.setValue(mData.roles.map(function (item) {
                            return item.roleId;
                        }));
                    }
                    // 禁止弹窗出现滚动条
                    $(layero).children('.layui-layer-content').css('overflow', 'visible');
                }
            });
        }

        /* 操作栏删除实现具体方法 */
        function doDel(obj) {
            var currDatas  = obj.data;
            layer.confirm('系统将删除当前数机器人据，确认要删除吗？', {
                icon:2,
                title:'温馨提示',
                skin: 'layui-layer-admin',
                shade: .1
            }, function (i) {
                layer.close(i);
                // var loadIndex = layer.load(2);

                var param = {};
                param['token'] = $.cookie('tokenMyb');
                param['action'] = 'DEL';
                param['id'] = currDatas.id;
                $.ajax({
                    url: js_global_requestAddress_setRobot,
                    data: param,
                    type: "POST",
                    dataType: "json",
                    success: function (addResult) {

                        if (addResult.code === 200) {
                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 1});
                            setTimeout(function () {
                                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                                parent.layer.close(index);
                                window.parent.location.reload();
                            }, 1300)

                        } else {

                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 2});


                        }


                    },
                    end : function() {//弹窗关闭后的回调函数
                        //利用laypage实现局部刷新,以下两种方式都可以
                        // $(".layui-laypage-btn").click()
                        //直接刷新当前修改的行
                        // $(".layui-laypage-btn")[0].click()
                        // window.parent.location.reload();
                    }

                });

            });
        }


        //开关按钮操作
        form.on('switch(playSwitch)', function(obj){


            // 获取当前控件
            var selectIfKey=obj.othis;
            // 获取当前所在行
            var parentTr = selectIfKey.parents("tr");
            // 获取当前所在行的索引
            // var parentTrIndex = parentTr.attr("data-index");

            //通过相对位置找对应行数据(获取ID)
            // 获取当前行第一和三列的值,这种是直接取值
            var currentwx_id = parentTr.find(('td:eq(1)')).text().trim();
            //这种方式是利用自定义值来取
            var switch_moni_id = obj.elem.attributes['switch_moni_id'].nodeValue;

            // console.log("currentwx_id",currentwx_id,switch_moni_id)

            var currStatusBool = obj.elem.checked;


            var messageTitle = '';
            var currStatusNum = 0;
            if(currStatusBool){

                messageTitle = '系统将对该玩法进行开启操作,确定对当前玩法进行开启操作吗?'

            }else{

                messageTitle = '系统将对该玩法进行关闭操作,确定对当前玩法进行进行关闭操作吗?'
            }

            layer.open({
                // type: 2,
                area: ['450px', '195px'],
                fix: false,
                //不固定
                maxmin: true,
                shade: 0.3,
                skin: 'layui-layer-rim',//加上边框
                title: "温馨提示",
                content:messageTitle,
                // content: `<div>`+messageTitle+`</div>`,
                btn: ['确定','取消'],
                // // 弹层外区域关闭
                shadeClose: true,
                btn1: function(index, layero) {//确定事件
                    //点击第一个按钮处理逻辑
                    // layer.msg("1");
                    if(currStatusBool){

                        // messageTitle = '系统将对该机器人进行开启操作,确定对当前机器人进行开启操作吗?'

                        currStatusNum = 1
                    }else{

                        // messageTitle = '系统将对该机器人进行关闭操作,确定对当前机器人进行关闭操作吗?'

                        currStatusNum = 2

                    }

                    //进行ajax请求
                    $.ajax({
                        url: js_global_requestAddress_SetPlay+"?Status="+currStatusNum+
                            "&ID="+switch_moni_id+"&action=UPDATE",
                        // data: param,
                        type: "GET",
                        dataType: "json",
                        success: function (addResult) {

                            if (addResult.code === 200) {
                                notice.msg(addResult.msg, {icon: 1});
                                insTb.reload();
                                layer.close(index);

                            } else {

                                notice.msg(addResult.msg, {icon: 2});
                                insTb.reload();
                                layer.close(index);
                            }


                        },


                    });

                },
                btn2: function(index, layero){//取消事件
                    //点击第二个按钮处理逻辑
                    // layer.msg("2");

                    notice.msg("取消操作", {icon: 5});
                    // $.message({
                    //     message: "取消操作",
                    //     type: 'info',
                    //     showClose: true
                    // });

                    var x = obj.elem.checked;

                    obj.elem.checked = !x;
                    form.render();
                    layer.close(index);
                },
                cancel: function(index, layero){//取消事件
                    //点击第二个按钮处理逻辑
                    // layer.msg("2");


                    notice.msg("取消操作", {icon: 5});

                    var x = obj.elem.checked;

                    obj.elem.checked = !x;
                    form.render();
                    layer.close(index);
                }
            })


        });

        /* 下拉框选中事件 */
        var bet_tb_this;
        form.on('select(group)', function (data) {

            // console.log("data",data)

            //2.6.0之前清除保留之前的数据的最有用的方式
            if (bet_tb_this != null) {
                // console.log("book_tb_this--不为null",bet_tb_this)
                bet_tb_this.where = {};  //置空where
            }
            if(data.value == "7777777"){
                insTb.reload({
                    method: 'post',
                    where: {
                        token:$.cookie('tokenMyb'),
                        action:'GET'
                    },
                    done: function (res, curr, count) {
                        bet_tb_this = this;
                        // console.log("book_tb_this----重载后的值",bet_tb_this)


                        jsonDataInit = res.data

                        $('tr').css({'background-color': '#fff', 'color': '#191a1c'});

                        res.data.forEach(function (item, index) {//根据已有的值回填下拉框

                            layui.each($("select[name='editStateS']", ""), function (index, item) {
                                let elem = $(item);
                                let currNum = elem.data('value')
                                // currNum = (currNum * 10) + "%"
                                // console.log("elem.data('value')",elem.data('value'))
                                elem.next().children().children()[0].defaultValue = currNum;
                                //elem.val(elem.data('value'));
                            });


                            layui.each($("select[name='editKinds']", ""), function (index, item) {
                                let elem = $(item);
                                let currNum = elem.data('value')
                                // currNum = (currNum * 10) + "%"
                                // console.log("elem.data('value')",elem.data('value'))
                                // elem.next().children().children()[0].defaultValue = currNum;
                                elem.val(currNum);
                            });

                            table.render('select');
                        })


                    }
                },false);
            }else{

                insTb.reload({
                    method: 'post',
                    where: {
                        token:$.cookie('tokenMyb'),
                        play_kinds_id:data.value ,
                        action:'GET'
                    },

                    done: function (res, curr, count) {
                        bet_tb_this = this;
                        // console.log("book_tb_this----重载后的值",bet_tb_this)

                        jsonDataInit = res.data

                        $('tr').css({'background-color': '#fff', 'color': '#191a1c'});

                        res.data.forEach(function (item, index) {//根据已有的值回填下拉框
                            layui.each($("select[name='editStateS']", ""), function (index, item) {
                                var elem = $(item);
                                let currNum = elem.data('value')
                                currNum = (currNum * 10) + "%"
                                // console.log("elem.data('value')",elem.data('value'))
                                elem.next().children().children()[0].defaultValue = currNum;
                                //elem.val(elem.data('value'));
                            });
                            table.render('select');
                        })

                    }
                },false);
            }





            return false;
        });

        //监听下拉框编辑
        form.on('select(editName)', function (data) {

            //获取当前行tr对象
            var elem = data.othis.parents('tr');
            //第一列的值是Guid，取guid来判断
            var Guid= elem.first().find('td').eq(1).text();
            //选择的select对象值；
            var selectValue = data.value;
            // console.log("selectValue",selectValue)
            // //这里的JsonDataInti是我自定义的table中数据的缓存数据，下拉数据修改时赋值到这一行缓存数据
            // for (i = 0; i < jsonDataInit.length; i++) {
            //     if (jsonDataInit[i].Guid == Guid) {
            //         jsonDataInit[i].NewReformStatus = selectValue; //更新被修改的行数据
            //     }
            // }

            // console.log("jsonDataInit",Guid)

            $.ajax({
                url: js_global_requestAddress_SetPlay+"?Name="+selectValue+
                    "&ID="+Guid+"&action=UPDATE",
                // data: param,
                type: "GET",
                dataType: "json",
                success: function (addResult) {

                    if (addResult.code === 200) {
                        notice.msg(addResult.msg, {icon: 1});
                        insTb.reload();

                    } else {

                        notice.msg(addResult.msg, {icon: 2});
                        insTb.reload();
                    }


                },


            });

        })


        //监听下拉框编辑
        form.on('select(selectKinds)', function (data) {

            //获取当前行tr对象
            var elem = data.othis.parents('tr');
            //第一列的值是Guid，取guid来判断
            var Guid= elem.first().find('td').eq(1).text();
            //选择的select对象值；
            var selectValue = data.value;
            // console.log("selectValue",selectValue)
            // //这里的JsonDataInti是我自定义的table中数据的缓存数据，下拉数据修改时赋值到这一行缓存数据
            // for (i = 0; i < jsonDataInit.length; i++) {
            //     if (jsonDataInit[i].Guid == Guid) {
            //         jsonDataInit[i].NewReformStatus = selectValue; //更新被修改的行数据
            //     }
            // }

            // console.log("jsonDataInit",Guid)

            $.ajax({
                url: js_global_requestAddress_GetUsers+"&action=GET",
                // data: param,
                type: "GET",
                dataType: "json",
                success: function (addResult) {

                    if (addResult.code === 200) {
                        notice.msg(addResult.msg, {icon: 1});
                        insTb.reload();

                    } else {

                        notice.msg(addResult.msg, {icon: 2});
                        insTb.reload();
                    }


                },


            });

        })

        //监听单元格编辑
        table.on('edit(userTable)', function(obj){
            var value = obj.value //得到修改后的值
                ,data = obj.data //得到所在行所有键值
                ,field = obj.field; //得到字段

            // console.log("field",value,data,field)
            // layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改值为：'+ util.escape(value));

            let requestUrl = js_global_requestAddress_SetPlay + "?action=UPDATE"

            // if(field === 'Name'){
            //     requestUrl = requestUrl + "&Name=" + util.escape(value)
            // }

            if(field === 'Remark'){
                requestUrl = requestUrl + "&Remark=" + util.escape(value)
            }

            if(field === 'HandAccountAddress'){
                requestUrl = requestUrl + "&HandAccountAddress=" + util.escape(value)
            }

            if(field === 'LossPerCent'){
                requestUrl = requestUrl + "&LossPerCent=" + util.escape(value)
            }

            if(field === 'MinBetMoneyForUsdt'){
                requestUrl = requestUrl + "&MinBetMoneyForUsdt=" + util.escape(value)
            }

            if(field === 'ManBetMoneyForUsdt'){
                requestUrl = requestUrl + "&ManBetMoneyForUsdt=" + util.escape(value)
            }

            if(field === 'MinBetMoneyForXrt'){
                requestUrl = requestUrl + "&MinBetMoneyForXrt=" + util.escape(value)
            }

            if(field === 'ManBetMoneyForXrt'){
                requestUrl = requestUrl + "&ManBetMoneyForXrt=" + util.escape(value)
            }

            requestUrl = requestUrl + "&ID=" + data.ID;

            // console.log("param",param)
            $.ajax({
                url: requestUrl,
                // data: param,
                type: "GET",
                dataType: "json",
                success: function (addResult) {

                    if (addResult.code === 200) {

                        notice.msg(addResult.msg, {icon: 1});
                        insTb.reload();

                    } else {

                        // layer.msg(addResult.msg);
                        notice.msg(addResult.msg, {icon: 2});


                    }


                },


            });


        });

        $("#addPlayInfo").click(function () {

            var index = layui.layer.open({
                area: ['800px', '500px'],
                fixed: false, //不固定
                maxmin: false,
                title : "添加记录",
                skin: 'layui-layer-rim',//加上边框
                type : 2,
                content : "add_play_info.html",
                success : function(layero, index){
                    var body = layui.layer.getChildFrame('body', index);


                },
                end : function() {//弹窗关闭后的回调函数
                    //利用laypage实现局部刷新,以下两种方式都可以
                    // $(".layui-laypage-btn").click()
                    //直接刷新当前修改的行
                    // $(".layui-laypage-btn")[0].click()

                    // window.parent.location.reload();


                    // window.location.reload();
                }
            })

            return false
        })


        $("#reloadData").click(function () {

            insTb.reload()
            return false
        })


    });

</script>
</body>
</html>
